---
title: Routing Protocol(Static/OSPF/BGP)
author: {name: mxxikr, link: 'https://github.com/mxxikr'}
date: 2022-11-11 01:29:00 +0900
category: [Network]
tags: [network, routing, ospf, bgp, cisco]
math: true
mermaid: false
---
<br/><br/>

## 라우팅(Routing) 개요

- **라우팅의 정의**
  - 패킷이 출발지에서 목적지까지 도달하는 **최적의 경로를 결정**하고 전달하는 과정임
  - DevOps 엔지니어로서 클라우드(AWS/GCP)와 온프레미스 연결 설계 시 필수 이해 항목임


<br/><br/>

## 라우팅 테이블과 포워딩 결정

### **라우팅 테이블 (Routing Table)**
- 라우터가 패킷을 어디로 보낼지 결정할 때 참조하는 이정표(주소록)임
- **구조 예시**
  ```
  Destination    Next Hop      Interface      Metric   AD
  10.0.0.0/24    192.168.1.1   eth0           10       110
  0.0.0.0/0      10.0.0.1      eth0           1        1  
  ```
  - **Destination**
    - 목적지 네트워크 대역임
  - **Next Hop**
    - 패킷을 전달할 다음 라우터의 IP임
  - **Interface**
    - 패킷이 나가는 출구 포트임
  - **Metric (Cost)**
    - 경로의 비용이며 낮을수록 좋음
  - **AD (Administrative Distance)**
    - 정보의 신뢰도이며 낮을수록 우선함

### **포워딩 결정 알고리즘 (Longest Prefix Match)**
- 라우터가 경로를 선택하는 절대적 규칙임
- **규칙**
  - 매칭되는 경로 중 **서브넷 마스크가 가장 긴(구체적인) 경로**를 선택함

![mermaid-diagram](/assets/img/network/2022-11-10-routing-diagram-1.png)


<br/><br/>

## 라우팅 프로토콜 (Static vs Dynamic)

- **Static Routing (정적 라우팅)**
  - 관리자가 경로를 **수동으로 입력**하는 방식임
  - **특징**
    - CPU 부하가 적고 보안성이 높음
    - 네트워크 변경 시 수동 재설정이 필요하여 확장성이 낮음
  - **설정 예시 (Cisco IOS)**
    ```shell
    # R1 Router (Global Mode)
    # 문법: ip route {목적지} {마스크} {NextHop}
    ip route 22.1.1.0 255.255.255.0 1.1.12.2
    ```

- **Default Routing (기본 라우팅)**
  - 경로를 모르는 모든 패킷을 특정 곳으로 보내는 설정(Last Resort)임
  - 인터넷으로 나가는 관문(Gateway) 설정에 주로 사용함
  - **설정 예시**
    ```shell
    # 모든 트래픽을 1.1.12.2로 전송
    ip route 0.0.0.0 0.0.0.0 1.1.12.2
    ```

- **Dynamic Routing (동적 라우팅)**
  - 라우터끼리 정보를 교환하여 경로를 **자동으로 학습**하고 갱신함
  - **특징**
    - 네트워크 변화(장애 등) 시 자동 우회(Self-healing)함
    - 설정이 복잡하고 CPU/메모리 자원을 사용함


<br/><br/>

## 주요 동적 라우팅 프로토콜 비교

- **프로토콜 비교표**

| 특성 | RIP | OSPF | EIGRP | BGP |
|------|-----|------|-------|-----|
| **유형** | Distance Vector | Link State | Hybrid | Path Vector |
| **규모** | 소규모 (15 홉) | 중~대규모 | 중~대규모 | 인터넷 (초대규모) |
| **기준(Metric)** | 홉 수 (Hop) | 대역폭 (Cost) | 대역폭+지연 | 속성 (Path Attributes) |
| **수렴 속도** | 느림 | 빠름 | 매우 빠름 | 느림 |
| **표준 여부** | 표준 | 표준 | Cisco 전용(현재 오픈) | 표준 |


### RIP (Routing Information Protocol)

- 가장 단순한 프로토콜임
- 홉 수(거쳐가는 라우터 수)만 고려함
- **단점**
  - 최대 15홉 제한이 있음
  - 속도가 느려도 홉 수가 적으면 선택하는 비효율이 발생함
- **설정 예시**
  ```shell
  router rip
   version 2
   network 10.0.0.0
   no auto-summary
  ```


### OSPF (Open Shortest Path First)

- 현재 엔터프라이즈 네트워킹의 **표준 IGP**임
- **Link State 방식**
  - 모든 라우터가 전체 네트워크 지도를 그림 (Dijkstra 알고리즘)
- **Area 개념**
  - 계층적 구조로 대규모 확장이 가능함
- **동작 과정**
  1. **Hello**
     - 이웃 라우터를 발견하고 관계를 형성함
  2. **LSA Flooding**
     - 자신의 링크 상태 정보를 전체에 전파함
  3. **SPF 계산**
     - 최단 경로 트리를 생성하여 라우팅 테이블에 등록함
- **설정 예시**
  ```shell
  # Process ID 110, Area 0 (Backbone)
  router ospf 110
   network 10.10.10.0 0.0.0.255 area 0
   network 1.1.1.1 0.0.0.0 area 0
  ```

![mermaid-diagram](/assets/img/network/2022-11-10-routing-diagram-2.png)


### EIGRP (Enhanced Interior Gateway Routing Protocol)
- Cisco 전용 프로토콜이며 설정이 쉽고 강력함
- 대역폭, 지연, 신뢰성 등 복합적인 Metric을 사용함
- **Dual 알고리즘**으로 매우 빠른 수렴 속도를 가짐
- **설정 예시**
  ```shell
  router eigrp 90
   network 10.0.0.0 0.255.255.255
   no auto-summary
  ```


### BGP (Border Gateway Protocol)
- **인터넷의 언어**이며 다른 AS와 통신할 때 필수임
- 경로의 효율성보다 **관리자의 정책(Policy)**이 최우선임
- AWS Direct Connect, Azure ExpressRoute 연결 시 사용함


<br/><br/>

## Route Aggregation (라우트 집계)

- 여러 개의 작은 네트워크(Subnet)를 하나의 큰 네트워크(Supernet)로 묶는 기술임
- **목적**
  - 라우팅 테이블 크기를 최소화하여 메모리를 절약함
  - 세부 네트워크 변화가 상위로 전파되지 않아 네트워크 안정성을 향상함
- ex)
  - 전
    - `172.16.1.0/24`, `172.16.2.0/24`, ... `172.16.255.0/24` (255개 경로)
  - 후
    - `172.16.0.0/16` (1개 경로로 축약)


<br/><br/>

## 예시 시나리오 (AWS 하이브리드 네트워크)

- **구성 아키텍처**
  - 온프레미스 데이터센터와 클라우드(AWS)를 연동함
  - **내부(IGP)**
    - OSPF를 사용하여 사내망을 라우팅함
  - **외부(EGP)**
    - BGP를 사용하여 AWS와 라우팅 정보를 교환함 (Direct Connect/VPN)

![mermaid-diagram](/assets/img/network/2022-11-10-routing-diagram-3.png)


<br/><br/>

## 최종 정리

### 어떤 프로토콜을 써야 하는가?

- **소규모 단일 경로**
  - **Static Routing** (가장 안정적이고 단순함)
- **사내 네트워크 (LAN/Campus)**
  - **OSPF** (표준이라 벤더 호환성이 좋음) 또는 **EIGRP** (All Cisco 환경에 적합함)
- **인터넷 연결 / 클라우드 전용선**
  - **BGP** (필수임)
- **복잡한 라우팅 정책 필요 시**
  - **Route Redistribution** (재분배)를 통해 서로 다른 프로토콜 간 연결함