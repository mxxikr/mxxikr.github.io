<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="ko"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템" /><meta name="author" content="mxxikr" /><meta property="og:locale" content="en" /><meta name="description" content="시스템 개요 단일 서버 환경에서 Docker Compose를 사용하여 고가용성 Kafka 클러스터를 구축하는 전체 과정을 다룸" /><meta property="og:description" content="시스템 개요 단일 서버 환경에서 Docker Compose를 사용하여 고가용성 Kafka 클러스터를 구축하는 전체 과정을 다룸" /><link rel="canonical" href="https://mxxikr.github.io/posts/apache-kafka-quick-start/" /><meta property="og:url" content="https://mxxikr.github.io/posts/apache-kafka-quick-start/" /><meta property="og:site_name" content="MXXI.kr" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-10-12T09:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@mxxikr" /><meta name="google-site-verification" content="jrB0ZGRmhAQ9sqzUNV-C9QdF0brDTEBfkBb9o7loUxc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"mxxikr"},"dateModified":"2025-10-20T03:16:35+09:00","datePublished":"2025-10-12T09:00:00+09:00","description":"시스템 개요 단일 서버 환경에서 Docker Compose를 사용하여 고가용성 Kafka 클러스터를 구축하는 전체 과정을 다룸","headline":"Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템","mainEntityOfPage":{"@type":"WebPage","@id":"https://mxxikr.github.io/posts/apache-kafka-quick-start/"},"url":"https://mxxikr.github.io/posts/apache-kafka-quick-start/"}</script><title>Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템 | MXXI.kr</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png?v=3"><link rel="icon" type="image/png" sizes="512x512" href="/assets/img/favicons/android-chrome-512x512.png?v=3"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-chrome-192x192.png?v=3"><link rel="icon" type="image/png" sizes="64x64" href="/assets/img/favicons/favicon-64x64.png?v=3"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png?v=3"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png?v=3"><link rel="manifest" href="/assets/img/favicons/site.webmanifest?v=3"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico?v=3"><meta name="apple-mobile-web-app-title" content="MXXI.kr"><meta name="application-name" content="MXXI.kr"><meta name="msapplication-TileColor" content="#c4beed"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml?v=2"><meta name="theme-color" content="#c4beed"> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script> document.addEventListener('DOMContentLoaded', function() { mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose', flowchart: { curve: 'basis', padding: 15, nodeSpacing: 30, rankSpacing: 50, htmlLabels: true } }); // Mermaid 다이어그램 렌더링 후 스타일 적용 setTimeout(function() { document.querySelectorAll('.mermaid').forEach(function(element) { element.style.background = '#f8f9fa'; element.style.padding = '15px'; element.style.borderRadius = '8px'; element.style.marginTop = '10px'; element.style.marginBottom = '20px'; }); }, 1000); }); </script><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//fonts.gstatic.com"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="preload" href="/assets/css/style.css" as="style"><link rel="preload" href="/assets/js/apple-liquid-glass.js" as="script"> <script> // 개발 환경에서만 로딩 시간 체크 if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') { window.addEventListener('load', () => { if ('performance' in window) { const perfData = performance.getEntriesByType('navigation')[0]; const loadTime = perfData.loadEventEnd - perfData.loadEventStart; console.log('📊 Page loaded in:', loadTime + 'ms'); } }); } </script> <script> if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js') .then(registration => console.log('SW registered')) .catch(error => console.log('SW registration failed')); }); } </script> <script> (function() { 'use strict'; // Intersection Observer 지원 확인 if (!('IntersectionObserver' in window)) { // 폴백: 모든 이미지를 즉시 로드 const images = document.querySelectorAll('img[data-src]'); images.forEach(img => { img.src = img.dataset.src; img.removeAttribute('data-src'); }); return; } // 이미지 지연 로딩 설정 const imageObserver = new IntersectionObserver((entries, observer) => { entries.forEach(entry => { if (entry.isIntersecting) { const img = entry.target; // 이미지 로드 const loadImage = () => { const src = img.dataset.src; if (src) { img.src = src; img.classList.add('loaded'); img.removeAttribute('data-src'); } }; // 이미지 로드 완료 시 처리 img.onload = () => { img.classList.add('fade-in'); }; // 이미지 로드 에러 시 처리 img.onerror = () => { img.classList.add('error'); console.warn('Failed to load image:', img.dataset.src); }; loadImage(); observer.unobserve(img); } }); }, { rootMargin: '50px 0px', // 50px 전에 미리 로드 threshold: 0.01 }); // 모든 지연 로딩 이미지에 Observer 적용 const lazyImages = document.querySelectorAll('img[data-src]'); lazyImages.forEach(img => { imageObserver.observe(img); }); // 페이지 로드 완료 후 남은 이미지들 처리 window.addEventListener('load', () => { const remainingImages = document.querySelectorAll('img[data-src]'); remainingImages.forEach(img => { img.src = img.dataset.src; img.removeAttribute('data-src'); }); }); })(); </script><style> img[data-src] { opacity: 0; transition: opacity 0.3s ease-in-out; } img.loaded { opacity: 1; } img.fade-in { animation: fadeIn 0.5s ease-in-out; } img.error { opacity: 0.5; filter: grayscale(100%); } @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } } /* 플레이스홀더 스타일 */ .lazy-placeholder { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; } @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }</style><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-center"><div class="profile-wrapper text-center"><div class="site-title"> <a href="/">MXXI.kr</a></div><div class="site-subtitle font-weight-bold">Backend Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mxxikr" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mxxikr','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1760227200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 12, 2025 </em> </span> <span> Updated <em class="" data-ts="1760897795" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 20, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> mxxikr </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6119 words"> read <em>33 min</em> </span></div></div></div><div class="post-content"><h2 id="시스템-개요"><span class="mr-2">시스템 개요</span><a href="#시스템-개요" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>단일 서버 환경에서 Docker Compose를 사용하여 고가용성 Kafka 클러스터를 구축하는 전체 과정을 다룸</ul><h3 id="시나리오"><span class="mr-2">시나리오</span><a href="#시나리오" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>시스템 목적<ul><li>스마트 팩토리 환경 모니터링 시스템<li>제조 공정의 온습도를 실시간으로 수집/분석하여 품질 관리<li>이상 상태 즉시 감지 및 알림으로 불량률 최소화</ul><li>시스템 구성 요소<ol><li>데이터 수집층<ul><li>공정별 온습도 센서 네트워크<li>센서당 초당 1회 데이터 수집<li>총 1000개 센서 (10개 공정 * 100개 측정 포인트)</ul><li>데이터 처리층<ul><li>Kafka 기반 실시간 스트리밍 처리<li>Active-Active 이중화 구성<li>다중 컨슈머 그룹으로 용도별 처리</ul><li>데이터 활용층<ul><li>실시간 모니터링 대시보드<li>이상 징후 자동 감지 및 알림<li>품질 분석을 위한 데이터 적재</ul></ol></ul><h3 id="시스템-요구사항-및-설계-원칙"><span class="mr-2">시스템 요구사항 및 설계 원칙</span><a href="#시스템-요구사항-및-설계-원칙" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>성능 요구사항<ul><li>처리 성능<ul><li>초당 1000개 이상 메시지 처리<li>10ms 이내 처리 지연<li>데이터 손실률 0% (min.insync.replicas=2로 보장)</ul><li>가용성<ul><li>99.9% 이상 서비스 가용성<li>Active-Active 이중화로 단일 장애 대응<li>자동 복구 및 재조정</ul><li>모니터링<ul><li>실시간 메트릭 수집 (15초 주기)<li>텔레그램 즉시 알림<li>시스템 자원 모니터링</ul></ul><li>기술 스택 선정<ul><li>애플리케이션: Spring Boot 3.5.6, Java 17<li>메시징: Apache Kafka<li>저장소: PostgreSQL<li>모니터링: Prometheus, Grafana</ul></ul><h3 id="시스템-아키텍처"><span class="mr-2">시스템 아키텍처</span><a href="#시스템-아키텍처" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="mermaid"> graph TB subgraph "데이터 생산" P1[Producer 1\n정상: 1000/s\n피크: 2000/s] --&gt;|160B 데이터\n40B 헤더| T1 P2[Producer 2\n정상: 1000/s\n피크: 2000/s] --&gt;|160B 데이터\n40B 헤더| T1 P3[Producer 3\n정상: 1000/s\n피크: 2000/s] --&gt;|160B 데이터\n40B 헤더| T2 subgraph "Spring Boot 프로듀서" P1 P2 P3 end end subgraph "Kafka 클러스터" subgraph "토픽 구성" T1[Topic 1\n파티션: 6개\n복제팩터: 2\nISR: 2] --&gt;|파티션 1-2\n실시간 처리\n500msg/sec| CG1 T1 --&gt;|파티션 3-4\nDB 저장\n500msg/sec| CG2 T1 --&gt;|파티션 5-6\n분석 처리\n500msg/sec| CG3 T2[Topic 2\n파티션: 6개\n복제팩터: 2\nISR: 2] --&gt;|백업 처리\n500msg/sec| CG4 end subgraph "브로커 구성" B1[Broker 1\n16KB 배치\nmin.insync.replicas=2] B2[Broker 2\n16KB 배치\nmin.insync.replicas=2] ZK[ZooKeeper\n2181 포트\n메타데이터 관리] B1 &lt;--&gt;|Active-Active 복제| B2 B1 &lt;--&gt;|리더 선출\n설정 관리| ZK B2 &lt;--&gt;|리더 선출\n설정 관리| ZK end end subgraph "데이터 소비" subgraph "컨슈머 그룹" CG1[Group 1\n실시간 처리\n배치: 100건/100ms\nSLA: 10ms] CG2[Group 2\nDB 저장\n배치: 500건/초\n트랜잭션 처리] CG3[Group 3\n분석\n배치: 1000건/5초\n비동기 처리] CG4[Group 4\n백업\n배치: 1000건/5초\n비동기 처리] end CG1 --&gt;|실시간 처리| MC[메모리 캐시\n100ms 갱신] CG2 --&gt;|저장| DB[(PostgreSQL\n배치: 500\n2차 캐시)] CG3 --&gt;|5초 집계| AN[분석 서버] CG4 --&gt;|백업| BK[백업 스토리지] end subgraph "모니터링" B1 &amp; B2 --&gt;|JMX 메트릭| JX[JMX Exporter\n브로커 상태] P1 &amp; P2 &amp; P3 --&gt;|처리량/지연| AE[Actuator Endpoint] CG1 &amp; CG2 &amp; CG3 &amp; CG4 --&gt;|Lag/처리량| AE JX &amp; AE --&gt;|15초 수집| PR[Prometheus] PR --&gt;|대시보드| GF[Grafana] PR --&gt;|임계치 분석| AM[Alert Manager] AM --&gt;|실시간 알림| TG[Telegram Bot] subgraph "메트릭 지표" MT1[브로커: 파티션수/리더수] MT2[성능: 처리량/지연] MT3[자원: CPU/메모리/디스크] MT4[컨슈머: Lag/커밋률] end end</div><h3 id="상세-아키텍처-설계"><span class="mr-2">상세 아키텍처 설계</span><a href="#상세-아키텍처-설계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>처리량 및 가용성 설계<ul><li>수집 데이터 분석<ul><li>정상 상태: 초당 1000개 센서 데이터<li>순간 피크: 초당 2000개로 증가 가능<li>메시지 크기: 200바이트<ul><li>온도/습도 데이터: 160바이트<li>메시지 헤더: 40바이트</ul></ul><li>브로커 구성 결정<ul><li>브로커 2대 운영<ul><li>한 대 장애 시에도 서비스 계속하기 위함<li>부하 분산으로 안정성 확보</ul><li>ZooKeeper 연동 필수<ul><li>브로커 메타데이터 관리<li>리더 선출, 설정 관리<li>브로커와 별도 서버로 운영</ul></ul><li>파티션 및 데이터 관리 설계<ul><li>1단계: 기본 처리량 분석<ul><li>단일 파티션 처리량: 500 msg/s<li>필요 파티션 수: 2000 ÷ 500 = 4개<li>네트워크 대역폭: 2000 msg/s * 200B = 400KB/s</ul><li>2단계: Topic 1 컨슈머 그룹 고려<ul><li>실시간 처리용: 2개 파티션<li>DB 저장용: 2개 파티션<li>분석용: 2개 파티션<li>총 필요: 6개 파티션</ul><li>3단계: Topic 2 (백업) 파티션 설계<ul><li>처리량 요구사항: Topic 1과 동일<li>파티션 수: 6개 (2000 msg/s 처리 위해)<li>파티션 분배: 단일 컨슈머 그룹에서 전체 파티션 처리<li>처리 방식: 비동기 배치 처리로 성능 최적화</ul><li>4단계: 데이터 보존 정책<ul><li>Topic 1: 7일 보관 (실시간/분석 데이터)<li>Topic 2: 30일 보관 (백업 데이터)<li>디스크 사용량 경고 임계치: 80%</ul><li>5단계: 고가용성 및 정합성 전략<ul><li>복제본 수: 2 (1 리더 + 1 팔로워)<li>ISR 설정: 2 (데이터 유실 방지)<li>Producer acks: all (모든 ISR 확인)<li>리더 선출: preferred leader auto 활성화<li>재시도 정책: 최대 3회, 지수 백오프</ul></ul></ul><li>컨슈머 그룹 설계<ul><li>실시간 처리<ul><li>파티션: 1-2번<li>배치: 100건/100ms<li>SLA: 10ms 이내</ul><li>데이터베이스 저장<ul><li>파티션: 3-4번<li>배치: 500건/1초<li>트랜잭션 처리</ul><li>데이터 분석<ul><li>파티션: 5-6번<li>배치: 1000건/5초<li>비동기 처리</ul></ul></ol><h2 id="환경-구성"><span class="mr-2">환경 구성</span><a href="#환경-구성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="ubuntu-서버-준비"><span class="mr-2">Ubuntu 서버 준비</span><a href="#ubuntu-서버-준비" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>시스템 업데이트<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># 패키지 매니저 업데이트</span>
<span class="nb">sudo </span>apt update
  
<span class="c"># 시스템 패키지 업그레이드</span>
<span class="nb">sudo </span>apt upgrade <span class="nt">-y</span>
</pre></table></code></div></div></ul><h3 id="java-개발-환경-설정"><span class="mr-2">Java 개발 환경 설정</span><a href="#java-개발-환경-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>JDK 17 설치<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># JDK 17 설치</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>openjdk-17-jdk
  
<span class="c"># JAVA_HOME 환경변수 설정</span>
<span class="nb">echo</span> <span class="s2">"export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s2">"export PATH=</span><span class="se">\$</span><span class="s2">PATH:</span><span class="se">\$</span><span class="s2">JAVA_HOME/bin"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc
</pre></table></code></div></div><li>Gradle 설치<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># SDKMAN 설치</span>
curl <span class="nt">-s</span> <span class="s2">"https://get.sdkman.io"</span> | bash
<span class="nb">source</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.sdkman/bin/sdkman-init.sh"</span>
  
<span class="c"># Gradle 8.4 설치</span>
sdk <span class="nb">install </span>gradle 8.4
</pre></table></code></div></div></ul><h3 id="docker-설치"><span class="mr-2">Docker 설치</span><a href="#docker-설치" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Docker &amp; Docker Compose 설치<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c"># Docker GPG 키 추가</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>ca-certificates curl gnupg
<span class="nb">sudo install</span> <span class="nt">-m</span> 0755 <span class="nt">-d</span> /etc/apt/keyrings
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/keyrings/docker.gpg
  
<span class="c"># Docker 저장소 추가</span>
<span class="nb">echo</span> <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu </span><span class="se">\</span><span class="s2">
</span><span class="si">$(</span><span class="nb">.</span> /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$VERSION_CODENAME</span><span class="s2">"</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="se">\</span>
<span class="nb">sudo tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null
  
<span class="c"># Docker 엔진 설치</span>
<span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
  
<span class="c"># 사용자를 docker 그룹에 추가</span>
<span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span>
newgrp docker
</pre></table></code></div></div></ul><h2 id="kafka-클러스터-구성"><span class="mr-2">Kafka 클러스터 구성</span><a href="#kafka-클러스터-구성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="토픽-초기화-스크립트"><span class="mr-2">토픽 초기화 스크립트</span><a href="#토픽-초기화-스크립트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">scripts/kafka-init.sh</code> 파일 생성</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
  
<span class="c"># 토픽 생성 함수</span>
create_topic<span class="o">()</span> <span class="o">{</span>
  kafka-topics.sh <span class="nt">--create</span> <span class="se">\</span>
    <span class="nt">--if-not-exists</span> <span class="se">\</span>
    <span class="nt">--bootstrap-server</span> kafka1:9092,kafka2:9093 <span class="se">\</span>
    <span class="nt">--topic</span> <span class="nv">$1</span> <span class="se">\</span>
    <span class="nt">--partitions</span> <span class="nv">$2</span> <span class="se">\</span>
    <span class="nt">--replication-factor</span> <span class="nv">$3</span> <span class="se">\</span>
    <span class="nt">--config</span> cleanup.policy<span class="o">=</span>delete <span class="se">\</span>
    <span class="nt">--config</span> retention.ms<span class="o">=</span><span class="nv">$4</span>
<span class="o">}</span>
  
<span class="c"># sensor-data 토픽 생성 (7일 보존)</span>
create_topic <span class="s2">"sensor-data"</span> 6 2 604800000
  
<span class="c"># sensor-data-backup 토픽 생성 (30일 보존)</span>
create_topic <span class="s2">"sensor-data-backup"</span> 6 2 2592000000
  
<span class="nb">echo</span> <span class="s2">"Kafka topics initialized successfully"</span>
</pre></table></code></div></div></ul><h3 id="docker-compose-설정"><span class="mr-2">Docker Compose 설정</span><a href="#docker-compose-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code> 파일 생성</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># ZooKeeper - 카프카 브로커 메타데이터 관리</span>
  <span class="na">zookeeper</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-zookeeper:7.5.1</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">zookeeper</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">2181:2181"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">ZOOKEEPER_CLIENT_PORT</span><span class="pi">:</span> <span class="m">2181</span> <span class="c1"># ZooKeeper 포트</span>
      <span class="na">ZOOKEEPER_TICK_TIME</span><span class="pi">:</span> <span class="m">2000</span>   <span class="c1"># 타임아웃 설정(ms)</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/zookeeper/data:/var/lib/zookeeper/data</span>
      <span class="pi">-</span> <span class="s">./data/zookeeper/log:/var/lib/zookeeper/log</span>
    
  <span class="c1"># Kafka Broker 1 - 첫 번째 브로커</span>
  <span class="na">kafka1</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-kafka:7.5.1</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">kafka1</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9092:9092"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9991:9991"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">zookeeper</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/kafka1/data:/var/lib/kafka/data</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="c1"># 기본 설정</span>
      <span class="na">KAFKA_BROKER_ID</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">KAFKA_ZOOKEEPER_CONNECT</span><span class="pi">:</span> <span class="s">zookeeper:2181</span>
      <span class="na">KAFKA_ADVERTISED_LISTENERS</span><span class="pi">:</span> <span class="s">PLAINTEXT://kafka1:9092</span>
        
      <span class="c1"># 복제 및 고가용성 설정</span>
      <span class="na">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_DEFAULT_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_MIN_INSYNC_REPLICAS</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_AUTO_LEADER_REBALANCE_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">KAFKA_LEADER_IMBALANCE_CHECK_INTERVAL_SECONDS</span><span class="pi">:</span> <span class="m">300</span>
        
      <span class="c1"># 데이터 처리 설정</span>
      <span class="na">KAFKA_MESSAGE_MAX_BYTES</span><span class="pi">:</span> <span class="m">1048576</span>
      <span class="na">KAFKA_COMPRESSION_TYPE</span><span class="pi">:</span> <span class="s">producer</span>
      <span class="na">KAFKA_NUM_PARTITIONS</span><span class="pi">:</span> <span class="m">6</span>
        
      <span class="c1"># 데이터 보존 정책 - 전역 설정</span>
      <span class="na">KAFKA_LOG_RETENTION_HOURS</span><span class="pi">:</span> <span class="m">168</span>                     <span class="c1"># 기본 7일 보존</span>
      <span class="na">KAFKA_LOG_SEGMENT_BYTES</span><span class="pi">:</span> <span class="m">1073741824</span>               <span class="c1"># 세그먼트 크기 1GB</span>
      <span class="na">KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS</span><span class="pi">:</span> <span class="m">300000</span>      <span class="c1"># 체크 주기 5분</span>
      <span class="na">KAFKA_LOG_CLEANUP_POLICY</span><span class="pi">:</span> <span class="s">delete</span>                   <span class="c1"># 보존기간 초과시 삭제</span>

      <span class="c1"># 트랜잭션 관련 설정</span>
      <span class="na">KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_TRANSACTION_STATE_LOG_MIN_ISR</span><span class="pi">:</span> <span class="m">2</span>
        
      <span class="c1"># 모니터링 설정</span>
      <span class="na">KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>          <span class="c1"># 토픽 자동 생성 비활성화</span>
      <span class="na">KAFKA_AUTO_LEADER_REBALANCE_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>       <span class="c1"># 자동 리더 리밸런싱 활성화</span>
      <span class="na">KAFKA_LEADER_IMBALANCE_CHECK_INTERVAL_SECONDS</span><span class="pi">:</span> <span class="m">300</span> <span class="c1"># 리더 밸런싱 체크 주기</span>
      <span class="na">KAFKA_JMX_PORT</span><span class="pi">:</span> <span class="m">9991</span>                             <span class="c1"># JMX 포트</span>
      <span class="na">KAFKA_JMX_OPTS</span><span class="pi">:</span> <span class="s">-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false</span> 
        <span class="s">-Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka1</span>

    <span class="c1"># 리소스 제한</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
      
    <span class="c1"># 헬스체크</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">kafka-topics.sh</span><span class="nv"> </span><span class="s">--bootstrap-server</span><span class="nv"> </span><span class="s">localhost:9092</span><span class="nv"> </span><span class="s">--list"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      
    <span class="c1"># 로그 설정</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
    
  <span class="c1"># Kafka Broker 2 - 두 번째 브로커  </span>
  <span class="na">kafka2</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-kafka:7.5.1</span> 
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">kafka2</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9093:9093"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9992:9992"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">zookeeper</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/kafka2/data:/var/lib/kafka/data</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="c1"># 기본 설정</span>
      <span class="na">KAFKA_BROKER_ID</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_ZOOKEEPER_CONNECT</span><span class="pi">:</span> <span class="s">zookeeper:2181</span>
      <span class="na">KAFKA_ADVERTISED_LISTENERS</span><span class="pi">:</span> <span class="s">PLAINTEXT://kafka2:9093</span>
        
      <span class="c1"># 복제 및 고가용성 설정</span>
      <span class="na">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_DEFAULT_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_MIN_INSYNC_REPLICAS</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_AUTO_LEADER_REBALANCE_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">KAFKA_LEADER_IMBALANCE_CHECK_INTERVAL_SECONDS</span><span class="pi">:</span> <span class="m">300</span>
        
      <span class="c1"># 데이터 처리 설정</span>
      <span class="na">KAFKA_MESSAGE_MAX_BYTES</span><span class="pi">:</span> <span class="m">1048576</span>
      <span class="na">KAFKA_COMPRESSION_TYPE</span><span class="pi">:</span> <span class="s">producer</span>
      <span class="na">KAFKA_NUM_PARTITIONS</span><span class="pi">:</span> <span class="m">6</span>
        
      <span class="c1"># 데이터 보존 정책 - 전역 설정</span>
      <span class="na">KAFKA_LOG_RETENTION_HOURS</span><span class="pi">:</span> <span class="m">168</span>                     <span class="c1"># 기본 7일 보존</span>
      <span class="na">KAFKA_LOG_SEGMENT_BYTES</span><span class="pi">:</span> <span class="m">1073741824</span>               <span class="c1"># 세그먼트 크기 1GB</span>
      <span class="na">KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS</span><span class="pi">:</span> <span class="m">300000</span>      <span class="c1"># 체크 주기 5분</span>
      <span class="na">KAFKA_LOG_CLEANUP_POLICY</span><span class="pi">:</span> <span class="s">delete</span>                   <span class="c1"># 보존기간 초과시 삭제</span>

      <span class="c1"># 트랜잭션 관련 설정</span>
      <span class="na">KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">KAFKA_TRANSACTION_STATE_LOG_MIN_ISR</span><span class="pi">:</span> <span class="m">2</span>
        
      <span class="c1"># 모니터링 설정</span>
      <span class="na">KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>          <span class="c1"># 토픽 자동 생성 비활성화</span>
      <span class="na">KAFKA_AUTO_LEADER_REBALANCE_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>       <span class="c1"># 자동 리더 리밸런싱 활성화</span>
      <span class="na">KAFKA_LEADER_IMBALANCE_CHECK_INTERVAL_SECONDS</span><span class="pi">:</span> <span class="m">300</span> <span class="c1"># 리더 밸런싱 체크 주기</span>
      <span class="na">KAFKA_JMX_PORT</span><span class="pi">:</span> <span class="m">9992</span>                             <span class="c1"># JMX 포트</span>
      <span class="na">KAFKA_JMX_OPTS</span><span class="pi">:</span> <span class="s">-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false</span> 
        <span class="s">-Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka2</span>
          
    <span class="c1"># 리소스 제한</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
      
    <span class="c1"># 헬스체크</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">kafka-topics.sh</span><span class="nv"> </span><span class="s">--bootstrap-server</span><span class="nv"> </span><span class="s">localhost:9093</span><span class="nv"> </span><span class="s">--list"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      
    <span class="c1"># 로그 설정</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

  <span class="c1"># Prometheus - 메트릭 수집</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:v2.48.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="pi">-</span> <span class="s">./data/prometheus:/prometheus</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--config.file=/etc/prometheus/prometheus.yml'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--storage.tsdb.path=/prometheus'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--storage.tsdb.retention.time=30d'</span>
    
  <span class="c1"># Grafana - 대시보드 시각화</span>
  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana:10.2.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">grafana</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_USER=admin</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_PASSWORD=admin</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/grafana:/var/lib/grafana</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">prometheus</span>
    
  <span class="c1"># Alert Manager - 알림 발송</span>
  <span class="na">alertmanager</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/alertmanager:v0.26.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">alertmanager</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9094:9093"</span>  <span class="c1"># 호스트의 9094 포트를 컨테이너의 9093 포트에 매핑</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--config.file=/etc/alertmanager/alertmanager.yml'</span>

  <span class="c1"># Kafka 토픽 초기화</span>
  <span class="na">kafka-init</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-kafka:7.5.1</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">kafka1</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span> <span class="c1"># 실제로 서비스가 동작하는 상태</span>
      <span class="na">kafka2</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./scripts/kafka-init.sh:/scripts/kafka-init.sh</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">bash -c "</span>
        <span class="s">echo 'Waiting for Kafka to be ready...' &amp;&amp;</span>
        <span class="s">cub kafka-ready -b kafka1:9092,kafka2:9093 2 60 &amp;&amp;</span>
        <span class="s">echo 'Initializing Kafka topics...' &amp;&amp;</span>
        <span class="s">/scripts/kafka-init.sh"</span>
</pre></table></code></div></div></ul><h3 id="모니터링-설정"><span class="mr-2">모니터링 설정</span><a href="#모니터링-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Prometheus 설정 (<code class="language-plaintext highlighter-rouge">prometheus/prometheus.yml</code>)</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span>     <span class="c1"># 메트릭 수집 주기</span>
  <span class="na">evaluation_interval</span><span class="pi">:</span> <span class="s">15s</span>  <span class="c1"># 규칙 평가 주기</span>
  
<span class="na">rule_files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">rules/*.yml'</span>          <span class="c1"># 알림 규칙 파일</span>
  
<span class="na">alerting</span><span class="pi">:</span>
  <span class="na">alertmanagers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">static_configs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">alertmanager:9093'</span><span class="pi">]</span>
  
<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">kafka'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s1">'</span><span class="s">kafka1:9991'</span>    <span class="c1"># Kafka 브로커 1 JMX</span>
        <span class="pi">-</span> <span class="s1">'</span><span class="s">kafka2:9992'</span>    <span class="c1"># Kafka 브로커 2 JMX</span>
          
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">spring-actuator'</span>
    <span class="na">metrics_path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/actuator/prometheus'</span>
    <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">5s</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s1">'</span><span class="s">host.docker.internal:8080'</span> <span class="c1"># Spring Boot 애플리케이션</span>
          
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">node-exporter'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s1">'</span><span class="s">node-exporter:9100'</span>  <span class="c1"># 시스템 메트릭</span>
</pre></table></code></div></div><li><p>Alert Manager 설정 (<code class="language-plaintext highlighter-rouge">alertmanager/alertmanager.yml</code>)</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="na">global</span><span class="pi">:</span>
  <span class="na">resolve_timeout</span><span class="pi">:</span> <span class="s">5m</span>

<span class="na">route</span><span class="pi">:</span>
  <span class="na">receiver</span><span class="pi">:</span> <span class="s1">'</span><span class="s">telegram'</span>
  <span class="na">group_by</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">alertname'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">severity'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">consumer_group'</span><span class="pi">]</span>
  <span class="na">group_wait</span><span class="pi">:</span> <span class="s">10s</span>
  <span class="na">group_interval</span><span class="pi">:</span> <span class="s">10s</span>
  <span class="na">repeat_interval</span><span class="pi">:</span> <span class="s">1h</span>
    
  <span class="na">routes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span>
        <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>
      <span class="na">group_wait</span><span class="pi">:</span> <span class="s">0s</span>
      <span class="na">repeat_interval</span><span class="pi">:</span> <span class="s">5m</span>
    <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span>
        <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
      <span class="na">group_wait</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">repeat_interval</span><span class="pi">:</span> <span class="s">15m</span>
  
<span class="na">receivers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">telegram'</span>
    <span class="na">telegram_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">bot_token</span><span class="pi">:</span> <span class="s1">'</span><span class="s">YOUR_BOT_TOKEN'</span>
        <span class="na">chat_id</span><span class="pi">:</span> <span class="s">YOUR_CHAT_ID</span>
        <span class="na">parse_mode</span><span class="pi">:</span> <span class="s1">'</span><span class="s">HTML'</span>
        <span class="na">api_url</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://api.telegram.org'</span>
        <span class="na">message</span><span class="pi">:</span> <span class="pi">|-</span>
          <span class="s">🚨 &lt;b&gt;{{ .GroupLabels.alertname }}&lt;/b&gt;</span>
          <span class="s">심각도: {{ .Labels.severity }}</span>
          <span class="s">컨슈머 그룹: {{ .Labels.consumer_group }}</span>
          <span class="s">{{ .Annotations.description }}</span>
</pre></table></code></div></div></ul><h3 id="클러스터-실행"><span class="mr-2">클러스터 실행</span><a href="#클러스터-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>도커 컴포즈로 시작</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># 컨테이너 실행</span>
docker-compose up <span class="nt">-d</span>
  
<span class="c"># 컨테이너 상태 확인</span>
docker-compose ps
  
<span class="c"># 로그 확인</span>
docker-compose logs <span class="nt">-f</span>
</pre></table></code></div></div></ul><h2 id="spring-boot-애플리케이션-개발"><span class="mr-2">Spring Boot 애플리케이션 개발</span><a href="#spring-boot-애플리케이션-개발" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="gradle-의존성"><span class="mr-2">Gradle 의존성</span><a href="#gradle-의존성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">build.gradle</code> 설정</p><div class="language-groovy highlighter-rouge"><div class="code-header"> <span data-label-text="Groovy"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">'java'</span>
    <span class="n">id</span> <span class="s1">'org.springframework.boot'</span> <span class="n">version</span> <span class="s1">'3.5.6'</span>
    <span class="n">id</span> <span class="s1">'io.spring.dependency-management'</span> <span class="n">version</span> <span class="s1">'1.1.4'</span>
<span class="o">}</span>

<span class="n">group</span> <span class="o">=</span> <span class="s1">'com.example'</span>
<span class="n">version</span> <span class="o">=</span> <span class="s1">'1.0.0'</span>
<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="s1">'17'</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// Spring Boot</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.kafka:spring-kafka'</span>
      
    <span class="c1">// Database &amp; Caching</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
    <span class="n">implementation</span> <span class="s1">'org.postgresql:postgresql'</span>
    <span class="n">implementation</span> <span class="s1">'org.hibernate.orm:hibernate-jcache'</span>
    <span class="n">implementation</span> <span class="s1">'org.ehcache:ehcache:3.10.8'</span>
      
    <span class="c1">// Observability</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-actuator'</span>
    <span class="n">implementation</span> <span class="s1">'io.micrometer:micrometer-registry-prometheus'</span>
      
    <span class="c1">// lombok</span>
    <span class="n">compileOnly</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok'</span>
      
    <span class="c1">// 테스트</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.kafka:spring-kafka-test'</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="애플리케이션-설정"><span class="mr-2">애플리케이션 설정</span><a href="#애플리케이션-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><code class="language-plaintext highlighter-rouge">application.yml</code> 설정</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="c1"># Kafka 설정</span>
  <span class="na">kafka</span><span class="pi">:</span>
    <span class="na">bootstrap-servers</span><span class="pi">:</span> <span class="s">localhost:9092,localhost:9093</span>
    <span class="na">producer</span><span class="pi">:</span>
      <span class="na">key-serializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.StringSerializer</span>
      <span class="na">value-serializer</span><span class="pi">:</span> <span class="s">org.springframework.kafka.support.serializer.JsonSerializer</span>
      <span class="na">acks</span><span class="pi">:</span> <span class="s">all</span>                    <span class="c1"># 모든 ISR 확인</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>                   <span class="c1"># 재시도 정책: 최대 3회</span>
      <span class="na">retry-backoff-ms</span><span class="pi">:</span> <span class="m">1000</span>       <span class="c1"># 지수 백오프 시작값</span>
      <span class="na">batch-size</span><span class="pi">:</span> <span class="m">16384</span>            <span class="c1"># 배치 크기 16KB</span>
      <span class="na">buffer-memory</span><span class="pi">:</span> <span class="m">33554432</span>      <span class="c1"># 버퍼 메모리</span>
      <span class="na">compression-type</span><span class="pi">:</span> <span class="s">lz4</span>        <span class="c1"># 메시지 압축</span>
      <span class="na">max-request-size</span><span class="pi">:</span> <span class="m">1048576</span>    <span class="c1"># 최대 요청 크기 1MB</span>

    <span class="c1"># 공통 컨슈머 설정</span>
    <span class="na">consumer</span><span class="pi">:</span>
      <span class="na">key-deserializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.StringDeserializer</span>
      <span class="na">value-deserializer</span><span class="pi">:</span> <span class="s">org.springframework.kafka.support.serializer.JsonDeserializer</span>
      <span class="na">enable-auto-commit</span><span class="pi">:</span> <span class="kc">false</span>    <span class="c1"># 수동 커밋</span>
      <span class="na">auto-offset-reset</span><span class="pi">:</span> <span class="s">earliest</span>  <span class="c1"># 오프셋 초기화</span>
      <span class="na">heartbeat-interval</span><span class="pi">:</span> <span class="m">3000</span>     <span class="c1"># 하트비트 간격</span>
      <span class="na">session-timeout-ms</span><span class="pi">:</span> <span class="m">45000</span>    <span class="c1"># 세션 타임아웃</span>

    <span class="c1"># 실시간 처리 컨슈머 설정</span>
    <span class="na">consumer-realtime</span><span class="pi">:</span>
      <span class="na">group-id</span><span class="pi">:</span> <span class="s">realtime-processor</span>
      <span class="na">max-poll-records</span><span class="pi">:</span> <span class="m">100</span>        <span class="c1"># 100건/100ms</span>
      <span class="na">fetch-max-wait</span><span class="pi">:</span> <span class="m">100</span>          <span class="c1"># 100ms</span>
      <span class="na">fetch-min-bytes</span><span class="pi">:</span> <span class="m">1</span>           <span class="c1"># 최소 페치 크기</span>
      <span class="na">max-partition-fetch-bytes</span><span class="pi">:</span> <span class="m">1048576</span>

    <span class="c1"># 데이터베이스 저장 컨슈머 설정</span>
    <span class="na">consumer-database</span><span class="pi">:</span>
      <span class="na">group-id</span><span class="pi">:</span> <span class="s">database-processor</span>
      <span class="na">max-poll-records</span><span class="pi">:</span> <span class="m">500</span>        <span class="c1"># 500건/1초</span>
      <span class="na">fetch-max-wait</span><span class="pi">:</span> <span class="m">1000</span>         <span class="c1"># 1초</span>
      <span class="na">isolation-level</span><span class="pi">:</span> <span class="s">read_committed</span>  <span class="c1"># 트랜잭션 처리</span>
      <span class="na">fetch-min-bytes</span><span class="pi">:</span> <span class="m">1024</span>
      <span class="na">max-partition-fetch-bytes</span><span class="pi">:</span> <span class="m">1048576</span>

    <span class="c1"># 데이터 분석 컨슈머 설정</span>
    <span class="na">consumer-analytics</span><span class="pi">:</span>
      <span class="na">group-id</span><span class="pi">:</span> <span class="s">analytics-processor</span>
      <span class="na">max-poll-records</span><span class="pi">:</span> <span class="m">1000</span>       <span class="c1"># 1000건/5초</span>
      <span class="na">fetch-max-wait</span><span class="pi">:</span> <span class="m">5000</span>         <span class="c1"># 5초</span>
      <span class="na">fetch-min-bytes</span><span class="pi">:</span> <span class="m">2048</span>
      <span class="na">max-partition-fetch-bytes</span><span class="pi">:</span> <span class="m">1048576</span>
    
  <span class="c1"># Database 설정</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:postgresql://localhost:5432/kafka_stream</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.postgresql.Driver</span>
    <span class="na">hikari</span><span class="pi">:</span>
      <span class="na">maximum-pool-size</span><span class="pi">:</span> <span class="m">10</span>
      <span class="na">minimum-idle</span><span class="pi">:</span> <span class="m">5</span>
    
  <span class="c1"># JPA 설정</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">hibernate</span><span class="pi">:</span>
      <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">update</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">dialect</span><span class="pi">:</span> <span class="s">org.hibernate.dialect.PostgreSQLDialect</span>
        <span class="na">format_sql</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">show_sql</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">generate_statistics</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">cache</span><span class="pi">:</span>
          <span class="na">use_second_level_cache</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">region.factory_class</span><span class="pi">:</span> <span class="s">org.hibernate.cache.jcache.JCacheRegionFactory</span>
          <span class="na">provider_configuration_file_path</span><span class="pi">:</span> <span class="s">ehcache.xml</span>
        <span class="na">jdbc</span><span class="pi">:</span>
          <span class="na">batch_size</span><span class="pi">:</span> <span class="m">500</span>
          <span class="na">batch_versioned_data</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">order_inserts</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">order_updates</span><span class="pi">:</span> <span class="kc">true</span>
    
  <span class="c1"># 액추에이터 설정</span>
  <span class="na">management</span><span class="pi">:</span>
    <span class="na">endpoints</span><span class="pi">:</span>
      <span class="na">web</span><span class="pi">:</span>
        <span class="na">exposure</span><span class="pi">:</span>
          <span class="na">include</span><span class="pi">:</span> <span class="s">health,metrics,prometheus</span>
    <span class="na">metrics</span><span class="pi">:</span>
      <span class="na">tags</span><span class="pi">:</span>
        <span class="na">application</span><span class="pi">:</span> <span class="s">${spring.application.name}</span>
</pre></table></code></div></div></ul><h3 id="데이터-모델"><span class="mr-2">데이터 모델</span><a href="#데이터-모델" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">SensorDataRepository.java</code> - 센서 데이터 레포지토리</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 센서 데이터 영속성을 관리하는 리포지토리 인터페이스
* JpaRepository를 상속하여 기본적인 CRUD 작업과 페이징 기능을 제공
*/</span>
<span class="nd">@Repository</span> 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SensorDataRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">SensorData</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">SensorData.java</code> - 센서 데이터 모델</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nd">@Data</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"sensor_data"</span><span class="o">)</span>
<span class="nd">@Cacheable</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Cache</span><span class="o">(</span><span class="n">usage</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">CacheConcurrencyStrategy</span><span class="o">.</span><span class="na">READ_WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SensorData</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"sensor_id"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@Index</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"idx_sensor_id"</span><span class="o">)</span>    <span class="c1">// 조회 성능 향상을 위한 인덱스 생성</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">sensorId</span><span class="o">;</span>
      
    
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">temperature</span><span class="o">;</span>   <span class="c1">// 온도 데이터 컬럼</span>
      
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">humidity</span><span class="o">;</span>  <span class="c1">// 습도 데이터 컬럼</span>
      
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> 
    <span class="nd">@Index</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"idx_timestamp"</span><span class="o">)</span>    <span class="c1">// 시간 기반 조회를 위한 인덱스</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">;</span>  <span class="c1">// 측정 시간 컬럼</span>
      
    <span class="c1">// 낙관적 락을 위한 버전 관리</span>
    <span class="c1">// 동시성 제어: 여러 트랜잭션이 동시에 같은 데이터를 수정하는 것을 방지</span>
    <span class="nd">@Version</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">version</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><h3 id="메시지-생산자"><span class="mr-2">메시지 생산자</span><a href="#메시지-생산자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">KafkaProducerConfig.java</code> - 생산자 설정</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="cm">/**
 * Kafka 프로듀서 관련 설정을 담당하는 설정 클래스
* 메시지 직렬화, 브로커 연결 등 프로듀서의 핵심 설정을 정의
*/</span>
<span class="nd">@Configuration</span>  <span class="c1">// 스프링 설정 클래스임을 표시</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaProducerConfig</span> <span class="o">{</span>
      
    <span class="cm">/**
     * Kafka 프로듀서 팩토리 빈 생성
     * 프로듀서의 기본 설정을 구성하고 인스턴스를 생성하는 팩토리 제공
     *
     * @return 설정이 완료된 프로듀서 팩토리
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ProducerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="nf">producerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="c1">// 브로커 서버 리스트 설정</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="s">"localhost:9092,localhost:9093"</span><span class="o">);</span>
        <span class="c1">// 메시지 키의 직렬화 방식 설정</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">// 메시지 값의 직렬화 방식 설정 (JSON 형식)</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">JsonSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">DefaultKafkaProducerFactory</span><span class="o">&lt;&gt;(</span><span class="n">config</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="cm">/**
     * Kafka 템플릿 빈 생성
     *
     * @return 설정된 Kafka 템플릿
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="nf">kafkaTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;&gt;(</span><span class="n">producerFactory</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">SensorDataProducer.java</code> - 센서 데이터 생산</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 센서 데이터를 생성하고 Kafka로 전송하는 서비스 클래스
* 실시간으로 센서 데이터를 시뮬레이션하고 Kafka 토픽으로 전송
*/</span>
<span class="nd">@Service</span> 
<span class="nd">@Slf4j</span> 
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SensorDataProducer</span> <span class="o">{</span>
      
    <span class="c1">// Kafka로 메시지를 전송하기 위한 템플릿</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="n">kafkaTemplate</span><span class="o">;</span>
    <span class="c1">// 센서 데이터가 전송될 Kafka 토픽 이름</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TOPIC</span> <span class="o">=</span> <span class="s">"sensor-data"</span><span class="o">;</span>
      
    <span class="cm">/**
     * 센서 데이터 생성 및 전송 메서드
     * 매 밀리초마다 실행되어 임의의 센서 데이터를 생성하고 Kafka로 전송
     */</span>
    <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">fixedRate</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>  <span class="c1">// 1ms 간격으로 실행</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generateData</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">SensorData</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SensorData</span><span class="o">();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setSensorId</span><span class="o">(</span><span class="s">"SENSOR-"</span> <span class="o">+</span> <span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1001</span><span class="o">));</span> <span class="c1">// 1부터 1000까지의 센서 ID 임의 생성</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setTemperature</span><span class="o">(</span><span class="mf">20.0</span> <span class="o">+</span> <span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">*</span> <span class="mi">10</span><span class="o">);</span> <span class="c1">// 20-30도 사이의 임의 온도 생성</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setHumidity</span><span class="o">(</span><span class="mf">40.0</span> <span class="o">+</span> <span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">*</span> <span class="mi">20</span><span class="o">);</span> <span class="c1">// 40-60% 사이의 임의 습도 생성</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span> <span class="c1">// 현재 시간 기록</span>
          
        <span class="c1">// CompletableFuture를 사용한 비동기 전송</span>
        <span class="n">kafkaTemplate</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="no">TOPIC</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">getSensorId</span><span class="o">(),</span> <span class="n">data</span><span class="o">)</span>
            <span class="o">.</span><span class="na">whenComplete</span><span class="o">((</span><span class="n">result</span><span class="o">,</span> <span class="n">ex</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Sent data: {} with offset: {}"</span><span class="o">,</span> 
                        <span class="n">data</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getRecordMetadata</span><span class="o">().</span><span class="na">offset</span><span class="o">());</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Unable to send data: {} due to: {}"</span><span class="o">,</span> 
                        <span class="n">data</span><span class="o">,</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><h3 id="메시지-소비자"><span class="mr-2">메시지 소비자</span><a href="#메시지-소비자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">KafkaConsumerConfig.java</code> - 소비자 설정</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="cm">/**
 * Kafka 컨슈머 관련 설정을 담당하는 설정 클래스
* 메시지 역직렬화, 컨슈머 그룹, 배치 처리 등 컨슈머의 핵심 설정을 정의
*/</span>
<span class="nd">@Configuration</span> 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaConsumerConfig</span> <span class="o">{</span>
      
    <span class="cm">/**
     * Kafka 컨슈머 팩토리 빈 생성
     * 컨슈머의 기본 설정을 구성하고 인스턴스를 생성
     *
     * @return 설정이 완료된 컨슈머 팩토리
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ConsumerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="nf">consumerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="c1">// 브로커 서버 리스트 설정</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="s">"localhost:9092,localhost:9093"</span><span class="o">);</span>
        <span class="c1">// 컨슈머 그룹 ID 설정</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">GROUP_ID_CONFIG</span><span class="o">,</span> <span class="s">"sensor-group"</span><span class="o">);</span>
        <span class="c1">// 메시지 키의 역직렬화 방식 설정</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">StringDeserializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">// 메시지 값의 역직렬화 방식 설정 (JSON 형식)</span>
        <span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">JsonDeserializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">DefaultKafkaConsumerFactory</span><span class="o">&lt;&gt;(</span><span class="n">config</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="cm">/**
     * Kafka 리스너 컨테이너 팩토리 빈 생성
     *
     * @return 설정된 리스너 컨테이너 팩토리
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ConcurrentKafkaListenerContainerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="nf">kafkaListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ConcurrentKafkaListenerContainerFactory</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="n">factory</span> <span class="o">=</span> 
            <span class="k">new</span> <span class="nc">ConcurrentKafkaListenerContainerFactory</span><span class="o">&lt;&gt;();</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setConsumerFactory</span><span class="o">(</span><span class="n">consumerFactory</span><span class="o">());</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setBatchListener</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>                  <span class="c1">// 배치 처리 모드 활성화</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setConcurrency</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>                       <span class="c1">// 병렬 처리를 위한 컨슈머 스레드 수 설정</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">getContainerProperties</span><span class="o">().</span><span class="na">setPollTimeout</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span> <span class="c1">// 폴링 대기 시간 설정(ms)</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">SensorDataConsumer.java</code> - 센서 데이터 소비</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 센서 데이터를 소비하고 처리하는 서비스 클래스
* Kafka에서 메시지를 배치로 수신하여 데이터베이스에 저장하고 이상 징후를 모니터링
*/</span>
<span class="nd">@Service</span> 
<span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span> 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SensorDataConsumer</span> <span class="o">{</span>
      
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SensorDataRepository</span> <span class="n">sensorDataRepository</span><span class="o">;</span> <span class="c1">// 센서 데이터 저장을 위한 리포지토리</span>
      
    <span class="cm">/**
     * Kafka 토픽으로부터 센서 데이터를 배치로 수신하고 처리하는 메서드
     * 데이터베이스에 배치 저장하고 온도 이상 징후를 모니터링
     *
     * @param dataList   수신된 센서 데이터 목록
     * @param partitions 메시지가 수신된 파티션 번호 목록
     * @param offsets    메시지의 오프셋 목록
     * @throws RuntimeException 배치 처리 실패 시 발생
     */</span>
    <span class="nd">@KafkaListener</span><span class="o">(</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="s">"sensor-data"</span><span class="o">,</span>          <span class="c1">// 구독할 토픽</span>
        <span class="n">groupId</span> <span class="o">=</span> <span class="s">"db-saver-group"</span><span class="o">,</span>      <span class="c1">// 컨슈머 그룹 ID</span>
        <span class="n">containerFactory</span> <span class="o">=</span> <span class="s">"kafkaListenerContainerFactory"</span>  <span class="c1">// 컨테이너 팩토리</span>
    <span class="o">)</span>
    <span class="nd">@Transactional</span>  <span class="c1">// 트랜잭션 처리를 위한 어노테이션</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">consume</span><span class="o">(</span><span class="nd">@Payload</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SensorData</span><span class="o">&gt;</span> <span class="n">dataList</span><span class="o">)</span> <span class="o">{</span>
          
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Received batch of {} records"</span><span class="o">,</span> <span class="n">dataList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
          
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// JPA를 사용하여 데이터를 배치로 저장</span>
            <span class="n">sensorDataRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="n">dataList</span><span class="o">);</span>
              
            <span class="c1">// 고온 경고를 위한 메트릭 기록 및 모니터링</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">SensorData</span> <span class="n">data</span> <span class="o">:</span> <span class="n">dataList</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getTemperature</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">25.0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"High temperature alert: {}"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error processing batch: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Failed to process batch"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><h2 id="모니터링-대시보드"><span class="mr-2">모니터링 대시보드</span><a href="#모니터링-대시보드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="grafana-대시보드"><span class="mr-2">Grafana 대시보드</span><a href="#grafana-대시보드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>핵심 메트릭<ul><li>브로커 상태: 활성 파티션 수, 리더 수<li>메시지 처리량: 초당 메시지 수, 바이트 처리량<li>성능 지표: 요청 처리 시간, 실패율<li>컨슈머 상태: Lag, 오프셋 커밋 성공률<li>리소스 사용: CPU/메모리 사용률, 디스크 I/O</ul></ul><h3 id="알림-규칙"><span class="mr-2">알림 규칙</span><a href="#알림-규칙" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p><code class="language-plaintext highlighter-rouge">rules/kafka_alerts.yml</code> 설정</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre><span class="na">groups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kafka_system_alerts</span> <span class="c1"># 브로커 및 시스템 상태 모니터링</span>
    <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaBrokerDown</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">up{job="kafka"} == </span><span class="m">0</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">1m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Kafka</span><span class="nv"> </span><span class="s">브로커</span><span class="nv"> </span><span class="s">다운"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">브로커</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}가</span><span class="nv"> </span><span class="s">응답하지</span><span class="nv"> </span><span class="s">않습니다"</span>
            
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaUnderReplicatedPartitions</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">kafka_server_replicamanager_underreplicated_partitions &gt; </span><span class="m">0</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">5m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">복제</span><span class="nv"> </span><span class="s">파티션</span><span class="nv"> </span><span class="s">부족"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">브로커</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}에</span><span class="nv"> </span><span class="s">복제가</span><span class="nv"> </span><span class="s">부족한</span><span class="nv"> </span><span class="s">파티션이</span><span class="nv"> </span><span class="s">있습니다"</span>
            
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaHighCPU</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">rate(process_cpu_seconds_total[5m]) &gt; </span><span class="m">0.8</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">5m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">높은</span><span class="nv"> </span><span class="s">CPU</span><span class="nv"> </span><span class="s">사용률"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">인스턴스</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}의</span><span class="nv"> </span><span class="s">CPU</span><span class="nv"> </span><span class="s">사용률이</span><span class="nv"> </span><span class="s">80%를</span><span class="nv"> </span><span class="s">초과했습니다"</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kafka_consumer_alerts</span> <span class="c1"># 컨슈머 그룹별 처리 지연 모니터링</span>
    <span class="na">rules</span><span class="pi">:</span>
      <span class="c1"># 실시간 처리 그룹</span>
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaRealtimeProcessorLag</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">kafka_consumergroup_lag{group="realtime-processor"} &gt; </span><span class="m">200</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">1m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>
          <span class="na">consumer_group</span><span class="pi">:</span> <span class="s">realtime-processor</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">실시간</span><span class="nv"> </span><span class="s">처리</span><span class="nv"> </span><span class="s">지연</span><span class="nv"> </span><span class="s">발생"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">실시간 처리 그룹에서 처리 지연이 발생했습니다.</span>
            <span class="s">- 컨슈머 그룹: {{ $labels.group }}</span>
            <span class="s">- 토픽: {{ $labels.topic }}</span>
            <span class="s">- 현재 Lag: {{ $value | printf "%.0f" }}건</span>
            <span class="no">  </span>
      <span class="c1"># DB 저장 그룹 (일반 처리)</span>
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaDatabaseProcessorLag</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">kafka_consumergroup_lag{group="database-processor"} &gt; </span><span class="m">1000</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">5m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
          <span class="na">consumer_group</span><span class="pi">:</span> <span class="s">database-processor</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">DB</span><span class="nv"> </span><span class="s">저장</span><span class="nv"> </span><span class="s">처리</span><span class="nv"> </span><span class="s">지연</span><span class="nv"> </span><span class="s">발생"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">DB 저장 그룹에서 처리 지연이 발생했습니다.</span>
            <span class="s">- 컨슈머 그룹: {{ $labels.group }}</span>
            <span class="s">- 토픽: {{ $labels.topic }}</span>
            <span class="s">- 현재 Lag: {{ $value | printf "%.0f" }}건</span>
            <span class="no">  </span>
      <span class="c1"># 분석 처리 그룹 (배치 처리)</span>
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">KafkaAnalyticsProcessorLag</span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">kafka_consumergroup_lag{group="analytics-processor"} &gt; </span><span class="m">5000</span>
        <span class="na">for</span><span class="pi">:</span> <span class="s">10m</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">info</span>
          <span class="na">consumer_group</span><span class="pi">:</span> <span class="s">analytics-processor</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">분석</span><span class="nv"> </span><span class="s">처리</span><span class="nv"> </span><span class="s">지연</span><span class="nv"> </span><span class="s">발생"</span>
          <span class="na">description</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">분석 처리 그룹에서 배치 처리 지연이 발생했습니다.</span>
            <span class="s">- 컨슈머 그룹: {{ $labels.group }}</span>
            <span class="s">- 토픽: {{ $labels.topic }}</span>
            <span class="s">- 현재 Lag: {{ $value | printf "%.0f" }}건</span>
</pre></table></code></div></div></ul><h2 id="테스트-및-운영"><span class="mr-2">테스트 및 운영</span><a href="#테스트-및-운영" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="성능-테스트"><span class="mr-2">성능 테스트</span><a href="#성능-테스트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><code class="language-plaintext highlighter-rouge">KafkaLoadTest.java</code> - 부하 테스트<div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaLoadTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">KafkaTemplate</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SensorData</span><span class="o">&gt;</span> <span class="n">kafkaTemplate</span><span class="o">;</span>
      
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">messageCount</span> <span class="o">=</span> <span class="mi">100000</span><span class="o">;</span>
        <span class="nc">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="n">messageCount</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">latencies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
          
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
          
        <span class="c1">// 병렬 메시지 전송</span>
        <span class="nc">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">messageCount</span><span class="o">)</span>
            <span class="o">.</span><span class="na">parallel</span><span class="o">()</span>
            <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="nc">SensorData</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SensorData</span><span class="o">();</span>
                <span class="n">data</span><span class="o">.</span><span class="na">setSensorId</span><span class="o">(</span><span class="s">"TEST-"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
                <span class="n">data</span><span class="o">.</span><span class="na">setTemperature</span><span class="o">(</span><span class="mf">20.0</span> <span class="o">+</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">10</span><span class="o">);</span>
                <span class="n">data</span><span class="o">.</span><span class="na">setHumidity</span><span class="o">(</span><span class="mf">40.0</span> <span class="o">+</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">20</span><span class="o">);</span>
                <span class="n">data</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
                  
                <span class="kt">long</span> <span class="n">sendTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
                <span class="n">kafkaTemplate</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"sensor-data"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">getSensorId</span><span class="o">(),</span> <span class="n">data</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">whenComplete</span><span class="o">((</span><span class="n">result</span><span class="o">,</span> <span class="n">ex</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                            <span class="c1">// 지연 시간 측정 (마이크로초 단위)</span>
                            <span class="kt">long</span> <span class="n">latency</span> <span class="o">=</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">sendTime</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">;</span>
                            <span class="kd">synchronized</span><span class="o">(</span><span class="n">latencies</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">latencies</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">latency</span><span class="o">);</span>
                            <span class="o">}</span>
                            <span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Failed to send message"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">});</span>
            <span class="o">});</span>
          
        <span class="c1">// 최대 1분간 대기</span>
        <span class="kt">boolean</span> <span class="n">completed</span> <span class="o">=</span> <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
          
        <span class="c1">// 성능 지표 계산</span>
        <span class="kt">double</span> <span class="n">duration</span> <span class="o">=</span> <span class="o">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">)</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="o">;</span>
        <span class="kt">double</span> <span class="n">throughput</span> <span class="o">=</span> <span class="n">messageCount</span> <span class="o">/</span> <span class="n">duration</span><span class="o">;</span>
          
        <span class="c1">// 지연 시간 통계</span>
        <span class="nc">DoubleSummaryStatistics</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">latencies</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">mapToDouble</span><span class="o">(</span><span class="nl">Long:</span><span class="o">:</span><span class="n">doubleValue</span><span class="o">)</span>
            <span class="o">.</span><span class="na">summaryStatistics</span><span class="o">();</span>
          
        <span class="c1">// 결과 출력</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"성능 테스트 결과:"</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 총 메시지: {} (성공: {})"</span><span class="o">,</span> <span class="n">messageCount</span><span class="o">,</span> <span class="n">latencies</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 처리 시간: {:.2f}초"</span><span class="o">,</span> <span class="n">duration</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 처리율: {:.0f} msg/sec"</span><span class="o">,</span> <span class="n">throughput</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 평균 지연: {:.2f}µs"</span><span class="o">,</span> <span class="n">stats</span><span class="o">.</span><span class="na">getAverage</span><span class="o">());</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 최대 지연: {:.2f}µs"</span><span class="o">,</span> <span class="n">stats</span><span class="o">.</span><span class="na">getMax</span><span class="o">());</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"- 최소 지연: {:.2f}µs"</span><span class="o">,</span> <span class="n">stats</span><span class="o">.</span><span class="na">getMin</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://kafka.apache.org/documentation/">Apache Kafka Documentation</a><li><a href="https://docs.spring.io/spring-kafka/docs/current/reference/html/">Spring for Apache Kafka</a><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html">Spring Boot Actuator</a><li><a href="https://docs.confluent.io/platform/current/kafka/monitoring.html">Kafka Monitoring</a><li><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/">Spring Data JPA Reference</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/messaging/'>Messaging</a>, <a href='/categories/kafka/'>Kafka</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kafka/" class="post-tag no-text-decoration" >kafka</a> <a href="/tags/apache/" class="post-tag no-text-decoration" >apache</a> <a href="/tags/monitoring/" class="post-tag no-text-decoration" >monitoring</a> <a href="/tags/spring-boot/" class="post-tag no-text-decoration" >spring boot</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템 - MXXI.kr&amp;url=https://mxxikr.github.io/posts/apache-kafka-quick-start/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템 - MXXI.kr&amp;u=https://mxxikr.github.io/posts/apache-kafka-quick-start/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://mxxikr.github.io/posts/apache-kafka-quick-start/&amp;text=Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템 - MXXI.kr" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="mxxikr/mxxikr.github.io" issue-term="pathname" label="comments" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/google-colab-font-error/">Google Colab 환경의 Matplotlib 한글 폰트 깨짐 현상</a><li><a href="/posts/apache-kafka-quick-start/">Apache Kafka와 Spring Boot로 구축하는 실시간 데이터 처리 시스템</a><li><a href="/posts/apache-kafka-concepts/">Apache Kafka 개념과 아키텍처</a><li><a href="/posts/image-auto-optimization/">Jekyll 블로그 이미지 자동 최적화</a><li><a href="/posts/jekyll-blog-installation-guide/">Jekyll 블로그 설치 및 로컬 실행 가이드</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/knou/">knou</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/data-information-processing/">data information processing</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/ubiquitous-computing/">ubiquitous computing</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div><script> $(document).ready(function() { // Bootstrap TOC 초기화 if ($('#toc').length) { $('#toc').toc({ 'selectors': 'h1,h2', 'container': '.post-content', 'smoothScrolling': true, 'highlightOffset': 50, 'scrollSpy': true, 'scrollSpyOffset': 50 }); // TOC 스타일 적용 함수 function applyTOCStyles() { $('#toc .nav-link').each(function() { var $link = $(this); var href = $link.attr('href'); // H1, H2 구분 if (href) { var targetElement = $(href); if (targetElement.length > 0) { var tagName = targetElement.prop('tagName'); if (tagName === 'H1') { $link.addClass('toc-h1'); } else if (tagName === 'H2') { $link.addClass('toc-h2'); } } } }); } // TOC 높이 동적 조정 함수 function adjustTOCHeight() { var toc = $('#toc'); if (toc.length === 0) return; // 먼저 모든 제한을 제거하고 자연스러운 높이로 설정 toc.css({ 'max-height': 'none', 'overflow-y': 'visible', 'overflow-x': 'visible' }); // 잠시 기다린 후 실제 내용 높이 측정 setTimeout(function() { var contentHeight = toc[0].scrollHeight; var screenHeight = $(window).height(); var maxHeight = screenHeight * 0.8; // 화면의 80%로 증가 console.log('TOC content height:', contentHeight, 'Screen height:', screenHeight, 'Max height:', maxHeight); if (contentHeight > maxHeight) { // 내용이 화면보다 크면 제한하고 스크롤 추가 toc.css({ 'max-height': maxHeight + 'px', 'overflow-y': 'auto', 'overflow-x': 'hidden' }); console.log('TOC height limited to', maxHeight + 'px with scroll'); } else { console.log('TOC using natural height:', contentHeight + 'px'); } }, 50); } // 스타일 적용 setTimeout(applyTOCStyles, 100); setTimeout(applyTOCStyles, 500); // TOC 높이 조정 - 여러 시점에서 실행 setTimeout(adjustTOCHeight, 200); setTimeout(adjustTOCHeight, 500); setTimeout(adjustTOCHeight, 1000); setTimeout(adjustTOCHeight, 2000); // 창 크기 변경 시 높이 재조정 $(window).on('resize', function() { setTimeout(adjustTOCHeight, 100); }); // 페이지 로드 완료 후에도 실행 $(window).on('load', function() { setTimeout(adjustTOCHeight, 500); }); // TOC 자동 스크롤 기능 (스크롤 박스가 있을 때만) var lastActiveItem = ''; function scrollToActiveTOCItem() { var activeItem = $('#toc .nav-link.active'); if (activeItem.length > 0) { var activeText = activeItem.text().trim(); // 같은 항목이면 스크롤하지 않음 if (lastActiveItem === activeText) { return; } lastActiveItem = activeText; var tocContainer = $('#toc'); if (tocContainer.length > 0) { var containerHeight = tocContainer.height(); var contentHeight = tocContainer[0].scrollHeight; // 스크롤이 필요한 경우에만 자동 스크롤 if (contentHeight > containerHeight) { var activeItemTop = activeItem.position().top; var activeItemHeight = activeItem.outerHeight(); var currentScrollTop = tocContainer.scrollTop(); // 활성 아이템이 보이는 영역에 있는지 확인 var itemTop = activeItemTop + currentScrollTop; var itemBottom = itemTop + activeItemHeight; var visibleTop = currentScrollTop; var visibleBottom = currentScrollTop + containerHeight; // 아이템이 보이지 않으면 스크롤 if (itemTop < visibleTop || itemBottom > visibleBottom) { var targetScrollTop = activeItemTop - (containerHeight / 2) + (activeItemHeight / 2); var maxScrollTop = contentHeight - containerHeight; targetScrollTop = Math.max(0, Math.min(targetScrollTop, maxScrollTop)); tocContainer.animate({ scrollTop: targetScrollTop }, 200); console.log('TOC auto-scrolled to:', activeText); } } } } } // 스크롤 스파이 개선 function initScrollSpy() { var $toc = $('#toc'); var $links = $toc.find('.nav-link'); var $sections = $('.post-content h1, .post-content h2'); // 스크롤 이벤트 최적화를 위한 throttle var scrollTimeout; $(window).on('scroll', function() { if (scrollTimeout) { clearTimeout(scrollTimeout); } scrollTimeout = setTimeout(function() { var scrollTop = $(window).scrollTop(); var windowHeight = $(window).height(); var current = ''; var currentOffset = 0; $sections.each(function() { var $section = $(this); var sectionTop = $section.offset().top; var sectionHeight = $section.outerHeight(); // 섹션의 상단이 화면 상단에서 150px 이내에 있으면 활성화 if (scrollTop + 150 >= sectionTop && scrollTop + 150 < sectionTop + sectionHeight + 200) { current = $section.attr('id'); currentOffset = sectionTop; } }); // 활성 링크 업데이트 $links.removeClass('active'); if (current) { var $activeLink = $links.filter('[href="#' + current + '"]'); $activeLink.addClass('active'); // TOC 자동 스크롤 scrollToActiveTOCItem(); } }, 10); }); // 초기 활성화 $(window).trigger('scroll'); } // 스크롤 스파이 초기화 setTimeout(initScrollSpy, 200); // 초기 실행 setTimeout(scrollToActiveTOCItem, 1500); } }); </script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/apache-kafka-concepts/"><div class="card-body"> <em class="timeago small" data-ts="1760198400" > 2025-10-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Apache Kafka 개념과 아키텍처</h3><div class="text-muted small"><p> 개요 Apache Kafka는 실시간으로 대량의 데이터를 안전하게 전달하고 처리하기 위한 플랫폼임 Kafka가 필요한 이유 우리가 사용하는 현대의 서비스들(넷플릭스, 쇼핑몰, SNS 등)은 수많은 데이터를 실시간으로 처리해야 함 사용자의 클릭, 검색, 결제 데이터 서비스 로그, 에러 메시지 I...</p></div></div></a></div><div class="card"> <a href="/posts/google-colab-font-error/"><div class="card-body"> <em class="timeago small" data-ts="1760832000" > 2025-10-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Google Colab 환경의 Matplotlib 한글 폰트 깨짐 현상</h3><div class="text-muted small"><p> 개요 Google Colab 환경에서 matplotlib 라이브러리 사용 시 한글 폰트가 네모(ㅁㅁㅁ) 형태로 깨지는 현상 해결 방법을 설명함 폰트 설치, matplotlib 폰트 캐시 갱신, 런타임 자동 재시작을 통해 문제를 해결함 문제 현상 matplotlib을 사용한 시각화 시 그래프의 제목, 축 라벨 등 한글 텍스트가 네모...</p></div></div></a></div><div class="card"> <a href="/posts/jekyll-blog-comments-utterances/"><div class="card-body"> <em class="timeago small" data-ts="1760176800" > 2025-10-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Jekyll 블로그 Utterances 댓글 시스템 추가</h3><div class="text-muted small"><p> 개요 Jekyll 블로그에 Utterances 댓글 시스템을 추가하는 방법을 설명함 Utterances란 특징 GitHub Issues 기반 댓글 시스템 무료 오픈소스 광고 없음 가벼운 용량 마크다운 지원 GitHub 로그인 필요 장점 설정이 간단함 GitHub Issues로 댓글 관리 용이 개발...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/apache-kafka-concepts/" class="btn btn-outline-primary" prompt="Older"><p>Apache Kafka 개념과 아키텍처</p></a> <a href="/posts/google-colab-font-error/" class="btn btn-outline-primary" prompt="Newer"><p>Google Colab 환경의 Matplotlib 한글 폰트 깨짐 현상</p></a></div></div></div><footer class="card-footer"><div class="align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/mxxikr">mxxikr</a>.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/knou/">knou</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/data-information-processing/">data information processing</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/ubiquitous-computing/">ubiquitous computing</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/network/">network</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script> document.addEventListener('DOMContentLoaded', function() { mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose', maxTextSize: 90000, flowchart: { htmlLabels: true, useMaxWidth: true, diagramPadding: 8, padding: 15, curve: 'basis', nodeSpacing: 80, rankSpacing: 100, ranker: 'tight-tree', align: 'UD', wrap: true, defaultRenderer: 'dagre-wrapper' } }); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/assets/js/apple-liquid-glass.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-G1QMP111QH"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-G1QMP111QH'); }); </script>
